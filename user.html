<!DOCTYPE html>
<html>
<head>
    <title>User Dashboard - FF Tournament</title>
    <style>
        body {
            background: linear-gradient(135deg, #0f3460 0%, #1a1a2e 100%);
            color: white;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .header {
            background: rgba(26, 26, 46, 0.9);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #ff6600;
        }
        .balance-card {
            background: linear-gradient(135deg, #ff6600, #ff3300);
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: bold;
        }
        .dashboard {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255,102,0,0.3);
        }
        .btn {
            background: #ff6600;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="header">
        <h2><i class="fas fa-fire"></i> User Dashboard</h2>
        <div>
            <span id="userEmail">Loading...</span>
            <button onclick="logout()" class="btn">Logout</button>
        </div>
    </div>
    
    <div class="dashboard">
        <div class="balance-card">
            <h3>Your Balance: <span id="userBalance">‡ß≥0</span></h3>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <h4>Free Fire ID</h4>
                <p id="userFFID">Loading...</p>
            </div>
            <div class="stat-card">
                <h4>Total Kills</h4>
                <p id="userKills">0</p>
            </div>
            <div class="stat-card">
                <h4>Matches Played</h4>
                <p id="userMatches">0</p>
            </div>
            <div class="stat-card">
                <h4>Tournaments Won</h4>
                <p id="userWins">0</p>
            </div>
        </div>
        
        <div style="margin-top: 30px;">
            <a href="index.html" class="btn">‚Üê Back to Home</a>
            <a href="#" onclick="rechargeBalance()" class="btn">‚ûï Add Balance</a>
            <a href="#" onclick="joinTournament()" class="btn">üéÆ Join Tournament</a>
        </div>
        
        <div id="tournamentsList" style="margin-top: 30px;">
            <h3>Available Tournaments</h3>
            <div id="tournamentsContainer">
                Loading tournaments...
            </div>
        </div>
    </div>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase v9 Modular SDK -->
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/auth.js"></script>
    
    <script>
        // Load user data when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            const userData = await getCurrentUserData();
            
            if(!userData) {
                window.location.href = 'login.html';
                return;
            }
            
            // Update user info
            document.getElementById('userEmail').textContent = userData.email || 'User';
            document.getElementById('userBalance').textContent = '‡ß≥' + (userData.balance || 0);
            document.getElementById('userFFID').textContent = userData.ffid || 'Not Set';
            document.getElementById('userKills').textContent = userData.kills || 0;
            document.getElementById('userMatches').textContent = userData.matches || 0;
            document.getElementById('userWins').textContent = userData.wins || 0;
            
            // Load tournaments
            loadTournaments();
        });
        
        // Load tournaments from database
        async function loadTournaments() {
            try {
                const tournamentsRef = ref(database, 'tournaments');
                const snapshot = await get(tournamentsRef);
                
                if(snapshot.exists()) {
                    const tournaments = snapshot.val();
                    let html = '<div class="stats">';
                    
                    Object.keys(tournaments).forEach(key => {
                        const t = tournaments[key];
                        html += `
                            <div class="stat-card">
                                <h4>${t.title || 'Tournament'}</h4>
                                <p>Entry: ‡ß≥${t.entryFee || 0}</p>
                                <p>Prize: ‡ß≥${t.prize || 0}</p>
                                <button onclick="joinTournament('${key}')" class="btn">Join</button>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    document.getElementById('tournamentsContainer').innerHTML = html;
                } else {
                    document.getElementById('tournamentsContainer').innerHTML = 
                        '<p>No tournaments available. Check back later!</p>';
                }
            } catch (error) {
                console.error('Error loading tournaments:', error);
                document.getElementById('tournamentsContainer').innerHTML = 
                    '<p>Error loading tournaments. Please refresh.</p>';
            }
        }
        
        // Join tournament function
        function joinTournament(tournamentId) {
            alert('Joining tournament: ' + tournamentId);
            // Add your join tournament logic here
        }
        
        // Recharge balance
        function rechargeBalance() {
            const amount = prompt('Enter amount to recharge (‡ß≥):');
            if(amount && !isNaN(amount)) {
                alert('Redirecting to payment gateway for ‡ß≥' + amount);
                // Add payment gateway integration here
            }
        }
    </script>
</body>
</html>
