<!DOCTYPE html>
<html>
<head>
    <title>Admin Panel - FF Tournament</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #f5f5f5;
        }
        .admin-header {
            background: linear-gradient(135deg, #2c3e50, #1a1a2e);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .admin-container {
            display: flex;
            min-height: 100vh;
        }
        .sidebar {
            width: 250px;
            background: #34495e;
            color: white;
            padding: 20px 0;
        }
        .sidebar a {
            display: block;
            color: #ddd;
            padding: 12px 20px;
            text-decoration: none;
            border-left: 4px solid transparent;
            transition: all 0.3s;
        }
        .sidebar a:hover, .sidebar a.active {
            background: #2c3e50;
            color: white;
            border-left: 4px solid #ff6600;
        }
        .main-content {
            flex: 1;
            padding: 20px;
        }
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .btn {
            background: #ff6600;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn-danger { background: #e74c3c; }
        .btn-success { background: #27ae60; }
        .btn-warning { background: #f39c12; }
        input, select {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .tournament-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .tournament-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            position: relative;
        }
        .status-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        .upcoming { background: #3498db; color: white; }
        .live { background: #e74c3c; color: white; animation: pulse 1.5s infinite; }
        .completed { background: #27ae60; color: white; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .player-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .player-table th, .player-table td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            text-align: left;
        }
        .player-table th {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <h2><i class="fas fa-user-shield"></i> Admin Panel</h2>
        <div>
            <span id="adminEmail"></span>
            <button onclick="logout()" class="btn">Logout</button>
        </div>
    </div>
    
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <a href="#" class="active" onclick="showSection('dashboard')">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a href="#" onclick="showSection('tournaments')">
                <i class="fas fa-trophy"></i> Tournament Management
            </a>
            <a href="#" onclick="showSection('users')">
                <i class="fas fa-users"></i> User Management
            </a>
            <a href="#" onclick="showSection('recharge')">
                <i class="fas fa-money-check-alt"></i> Recharge Requests
            </a>
            <a href="#" onclick="showSection('withdraw')">
                <i class="fas fa-money-bill-wave"></i> Withdraw Requests
            </a>
            <a href="index.html">
                <i class="fas fa-home"></i> Back to Home
            </a>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            
            <!-- Dashboard Section -->
            <div id="dashboardSection" class="content-section">
                <h2>Admin Dashboard</h2>
                <div class="card">
                    <h3>Quick Stats</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div style="text-align: center; padding: 15px; background: #e3f2fd; border-radius: 8px;">
                            <h3 id="totalUsers">0</h3>
                            <p>Total Users</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #e8f5e9; border-radius: 8px;">
                            <h3 id="totalTournaments">0</h3>
                            <p>Tournaments</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #fff3e0; border-radius: 8px;">
                            <h3 id="totalRevenue">৳0</h3>
                            <p>Total Revenue</p>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #f3e5f5; border-radius: 8px;">
                            <h3 id="pendingRequests">0</h3>
                            <p>Pending Requests</p>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Recent Tournaments</h3>
                    <div id="recentTournaments">
                        Loading...
                    </div>
                </div>
            </div>
            
            <!-- Tournament Management Section -->
            <div id="tournamentsSection" class="content-section" style="display: none;">
                <h2>Tournament Management</h2>
                
                <div class="card">
                    <h3>Create New Tournament</h3>
                    <input type="text" id="tournamentTitle" placeholder="Tournament Title">
                    <select id="tournamentType">
                        <option value="solo">Solo</option>
                        <option value="duo">Duo</option>
                        <option value="squad">Squad</option>
                    </select>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="number" id="entryFee" placeholder="Entry Fee (৳)">
                        <input type="number" id="prizePool" placeholder="Prize Pool (৳)">
                        <input type="number" id="killReward" placeholder="Kill Reward (৳)">
                        <input type="number" id="maxPlayers" placeholder="Max Players" value="25">
                    </div>
                    
                    <input type="datetime-local" id="tournamentTime">
                    
                    <button onclick="createTournament()" class="btn">Create Tournament</button>
                </div>
                
                <div class="card">
                    <h3>All Tournaments</h3>
                    <div id="allTournamentsList" class="tournament-list">
                        Loading tournaments...
                    </div>
                </div>
            </div>
            
            <!-- User Management Section -->
            <div id="usersSection" class="content-section" style="display: none;">
                <h2>User Management</h2>
                
                <div class="card">
                    <h3>All Users</h3>
                    <input type="text" id="searchUser" placeholder="Search users..." 
                           onkeyup="searchUsers()" style="margin-bottom: 20px;">
                    
                    <div id="usersList">
                        Loading users...
                    </div>
                </div>
            </div>
            
            <!-- Recharge Requests Section -->
            <div id="rechargeSection" class="content-section" style="display: none;">
                <h2>Recharge Requests</h2>
                
                <div class="card">
                    <h3>Pending Recharge Requests</h3>
                    <div id="rechargeRequests">
                        Loading recharge requests...
                    </div>
                </div>
            </div>
            
            <!-- Withdraw Requests Section -->
            <div id="withdrawSection" class="content-section" style="display: none;">
                <h2>Withdraw Requests</h2>
                
                <div class="card">
                    <h3>Pending Withdraw Requests</h3>
                    <div id="withdrawRequests">
                        Loading withdraw requests...
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA9HKKBo6KozIskG2oEF0PO7UCCScIxXdQ",
            authDomain: "freefiregame-85e60.firebaseapp.com",
            databaseURL: "https://freefiregame-85e60-default-rtdb.firebaseio.com",
            projectId: "freefiregame-85e60",
            storageBucket: "freefiregame-85e60.firebasestorage.app",
            messagingSenderId: "961424698248",
            appId: "1:961424698248:web:32e3d79f1bdfefaa9b283d",
            measurementId: "G-7D31XM1SBC"
        };
        
        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        
        // Check if user is admin
        auth.onAuthStateChanged(async (user) => {
            if (!user) {
                window.location.href = 'login.html';
                return;
            }
            
            document.getElementById('adminEmail').textContent = user.email;
            
            // Check if user is admin
            const userRef = database.ref('users/' + user.uid);
            userRef.once('value').then((snapshot) => {
                const userData = snapshot.val();
                if(userData && userData.role === 'admin') {
                    // Load admin data
                    loadAdminData();
                } else {
                    alert('Access denied! Admin only.');
                    window.location.href = 'user.html';
                }
            });
        });
        
        // Load admin data
        function loadAdminData() {
            loadUsers();
            loadTournaments();
            loadStats();
        }
        
        // Show section
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(sectionName + 'Section').style.display = 'block';
            
            // Update sidebar active state
            document.querySelectorAll('.sidebar a').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        // Create tournament
        async function createTournament() {
            const title = document.getElementById('tournamentTitle').value;
            const type = document.getElementById('tournamentType').value;
            const entryFee = document.getElementById('entryFee').value;
            const prize = document.getElementById('prizePool').value;
            const killReward = document.getElementById('killReward').value;
            const maxPlayers = document.getElementById('maxPlayers').value;
            const schedule = document.getElementById('tournamentTime').value;
            
            if(!title || !entryFee || !prize || !schedule) {
                alert('Please fill all required fields');
                return;
            }
            
            const tournamentData = {
                title: title,
                type: type,
                entryFee: parseInt(entryFee),
                prize: parseInt(prize),
                killReward: parseInt(killReward) || 10,
                maxPlayers: parseInt(maxPlayers) || 25,
                schedule: schedule,
                status: 'upcoming',
                joinedPlayers: 0,
                createdBy: auth.currentUser.uid,
                createdAt: Date.now()
            };
            
            try {
                const newTournamentRef = database.ref('tournaments').push();
                await newTournamentRef.set(tournamentData);
                
                alert('Tournament created successfully!');
                
                // Clear form
                document.getElementById('tournamentTitle').value = '';
                document.getElementById('entryFee').value = '';
                document.getElementById('prizePool').value = '';
                document.getElementById('killReward').value = '';
                
                // Refresh list
                loadTournaments();
                loadStats();
                
            } catch (error) {
                alert('Error creating tournament: ' + error.message);
            }
        }
        
        // Load tournaments
        async function loadTournaments() {
            try {
                const snapshot = await database.ref('tournaments').once('value');
                
                if(snapshot.exists()) {
                    const tournaments = snapshot.val();
                    let html = '';
                    let recentHtml = '<table style="width:100%"><tr><th>Tournament</th><th>Status</th><th>Players</th></tr>';
                    
                    Object.keys(tournaments).forEach(key => {
                        const t = tournaments[key];
                        
                        // Recent tournaments for dashboard
                        recentHtml += `
                            <tr>
                                <td>${t.title}</td>
                                <td><span class="status-badge ${t.status}">${t.status}</span></td>
                                <td>${t.joinedPlayers || 0}/${t.maxPlayers || 25}</td>
                            </tr>
                        `;
                        
                        // All tournaments for management
                        html += `
                            <div class="tournament-item">
                                <span class="status-badge ${t.status}">${t.status}</span>
                                <h4>${t.title}</h4>
                                <p>Type: ${t.type} | Entry: ৳${t.entryFee} | Prize: ৳${t.prize}</p>
                                <p>Players: ${t.joinedPlayers || 0}/${t.maxPlayers || 25}</p>
                                <p>Schedule: ${new Date(t.schedule).toLocaleString()}</p>
                                
                                <div style="margin-top: 10px;">
                                    ${t.status === 'upcoming' ? 
                                        `<button class="btn btn-success" onclick="startTournament('${key}')">
                                            Start Tournament
                                        </button>` : ''}
                                    
                                    ${t.status === 'live' ? 
                                        `<button class="btn btn-warning" onclick="completeTournament('${key}')">
                                            Complete
                                        </button>
                                        <button class="btn" onclick="viewPlayers('${key}')">
                                            View Players
                                        </button>` : ''}
                                    
                                    <button class="btn btn-danger" onclick="deleteTournament('${key}')">
                                        Delete
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    
                    recentHtml += '</table>';
                    document.getElementById('recentTournaments').innerHTML = recentHtml;
                    document.getElementById('allTournamentsList').innerHTML = html;
                } else {
                    document.getElementById('allTournamentsList').innerHTML = '<p>No tournaments found.</p>';
                    document.getElementById('recentTournaments').innerHTML = '<p>No tournaments found.</p>';
                }
            } catch (error) {
                console.error('Error loading tournaments:', error);
            }
        }
        
        // Start tournament
        async function startTournament(tournamentId) {
            if(!confirm('Start this tournament? Room ID and password will be generated.')) return;
            
            try {
                // Generate room ID and password
                const roomId = Math.floor(100000000 + Math.random() * 900000000).toString();
                const password = generatePassword();
                
                await database.ref('tournaments/' + tournamentId).update({
                    status: 'live',
                    roomId: roomId,
                    password: password,
                    liveAt: Date.now()
                });
                
                alert(`Tournament is now LIVE!\nRoom ID: ${roomId}\nPassword: ${password}`);
                loadTournaments();
                
            } catch (error) {
                alert('Error starting tournament: ' + error.message);
            }
        }
        
        // Complete tournament
        async function completeTournament(tournamentId) {
            if(!confirm('Complete this tournament? Results will be calculated.')) return;
            
            try {
                await database.ref('tournaments/' + tournamentId).update({
                    status: 'completed',
                    completedAt: Date.now()
                });
                
                alert('Tournament marked as completed!');
                loadTournaments();
                
            } catch (error) {
                alert('Error completing tournament: ' + error.message);
            }
        }
        
        // Delete tournament
        async function deleteTournament(tournamentId) {
            if(!confirm('Are you sure you want to delete this tournament?')) return;
            
            try {
                // Return money to players first
                const playersRef = database.ref('tournaments/' + tournamentId + '/players');
                const playersSnap = await playersRef.once('value');
                
                if(playersSnap.exists()) {
                    const players = playersSnap.val();
                    
                    for(const playerId in players) {
                        const entryFee = players[playerId].entryPaid || 0;
                        if(entryFee > 0) {
                            const userRef = database.ref('users/' + playerId);
                            const userSnap = await userRef.once('value');
                            const userData = userSnap.val();
                            
                            if(userData) {
                                await userRef.update({
                                    balance: (userData.balance || 0) + entryFee
                                });
                            }
                        }
                    }
                }
                
                // Delete tournament
                await database.ref('tournaments/' + tournamentId).remove();
                alert('Tournament deleted successfully!');
                loadTournaments();
                loadStats();
                
            } catch (error) {
                alert('Error deleting tournament: ' + error.message);
            }
        }
        
        // View players in tournament
        async function viewPlayers(tournamentId) {
            try {
                const snapshot = await database.ref('tournaments/' + tournamentId + '/players').once('value');
                
                if(snapshot.exists()) {
                    const players = snapshot.val();
                    let html = '<h4>Registered Players:</h4>';
                    html += '<table class="player-table">';
                    html += '<tr><th>Player</th><th>FF ID</th><th>Joined</th><th>Action</th></tr>';
                    
                    Object.keys(players).forEach(playerId => {
                        const player = players[playerId];
                        html += `
                            <tr>
                                <td>${player.name}</td>
                                <td>${player.ffid || 'N/A'}</td>
                                <td>${new Date(player.joinedAt).toLocaleDateString()}</td>
                                <td>
                                    <button class="btn btn-danger" onclick="removePlayer('${tournamentId}', '${playerId}')">
                                        Remove
                                    </button>
                                </td>
                            </tr>
                        `;
                    });
                    
                    html += '</table>';
                    alert(html);
                } else {
                    alert('No players have joined this tournament yet.');
                }
            } catch (error) {
                alert('Error loading players: ' + error.message);
            }
        }
        
        // Remove player from tournament
        async function removePlayer(tournamentId, playerId) {
            if(!confirm('Remove this player from tournament?')) return;
            
            try {
                // Get entry fee to return
                const playerRef = database.ref('tournaments/' + tournamentId + '/players/' + playerId);
                const playerSnap = await playerRef.once('value');
                const playerData = playerSnap.val();
                
                // Return entry fee
                if(playerData.entryPaid) {
                    const userRef = database.ref('users/' + playerId);
                    const userSnap = await userRef.once('value');
                    const userData = userSnap.val();
                    
                    if(userData) {
                        await userRef.update({
                            balance: (userData.balance || 0) + playerData.entryPaid
                        });
                    }
                }
                
                // Remove player
                await playerRef.remove();
                
                // Update player count
                const tournamentRef = database.ref('tournaments/' + tournamentId);
                const tournamentSnap = await tournamentRef.once('value');
                const tournament = tournamentSnap.val();
                
                await tournamentRef.update({
                    joinedPlayers: (tournament.joinedPlayers || 1) - 1
                });
                
                alert('Player removed successfully!');
                
            } catch (error) {
                alert('Error removing player: ' + error.message);
            }
        }
        
        // Load users
        async function loadUsers() {
            try {
                const snapshot = await database.ref('users').once('value');
                
                if(snapshot.exists()) {
                    const users = snapshot.val();
                    let html = '<table class="player-table">';
                    html += '<tr><th>Name</th><th>Email</th><th>FF ID</th><th>Balance</th><th>Actions</th></tr>';
                    
                    Object.keys(users).forEach(userId => {
                        const user = users[userId];
                        html += `
                            <tr>
                                <td>${user.name || 'N/A'}</td>
                                <td>${user.email || 'N/A'}</td>
                                <td>${user.ffid || 'N/A'}</td>
                                <td>৳${user.balance || 0}</td>
                                <td>
                                    <button class="btn" onclick="editUser('${userId}')">
                                        Edit
                                    </button>
                                    <button class="btn btn-success" onclick="addBalance('${userId}')">
                                        Add Balance
                                    </button>
                                </td>
                            </tr>
                        `;
                    });
                    
                    html += '</table>';
                    document.getElementById('usersList').innerHTML = html;
                }
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }
        
        // Search users
        function searchUsers() {
            const searchTerm = document.getElementById('searchUser').value.toLowerCase();
            const rows = document.querySelectorAll('#usersList tr');
            
            rows.forEach((row, index) => {
                if(index === 0) return; // Skip header
                
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }
        
        // Edit user
        async function editUser(userId) {
            const newBalance = prompt('Enter new balance for user:');
            if(newBalance && !isNaN(newBalance)) {
                try {
                    await database.ref('users/' + userId).update({
                        balance: parseInt(newBalance)
                    });
                    alert('User balance updated!');
                    loadUsers();
                    loadStats();
                } catch (error) {
                    alert('Error updating user: ' + error.message);
                }
            }
        }
        
        // Add balance to user
        async function addBalance(userId) {
            const amount = prompt('Enter amount to add:');
            if(amount && !isNaN(amount) && amount > 0) {
                try {
                    const userRef = database.ref('users/' + userId);
                    const userSnap = await userRef.once('value');
                    const userData = userSnap.val();
                    
                    const newBalance = (userData.balance || 0) + parseInt(amount);
                    await userRef.update({ balance: newBalance });
                    
                    // Add transaction record
                    const transactionRef = database.ref('users/' + userId + '/transactions/' + Date.now());
                    await transactionRef.set({
                        type: 'admin_added',
                        amount: parseInt(amount),
                        timestamp: Date.now(),
                        admin: auth.currentUser.email
                    });
                    
                    alert('Balance added successfully!');
                    loadUsers();
                    loadStats();
                    
                } catch (error) {
                    alert('Error adding balance: ' + error.message);
                }
            }
        }
        
        // Load stats
        async function loadStats() {
            try {
                // Load users count
                const usersSnap = await database.ref('users').once('value');
                const users = usersSnap.val() || {};
                document.getElementById('totalUsers').textContent = Object.keys(users).length;
                
                // Load tournaments count and revenue
                const tournamentsSnap = await database.ref('tournaments').once('value');
                const tournaments = tournamentsSnap.val() || {};
                document.getElementById('totalTournaments').textContent = Object.keys(tournaments).length;
                
                let totalRevenue = 0;
                Object.values(tournaments).forEach(t => {
                    totalRevenue += (t.entryFee || 0) * (t.joinedPlayers || 0);
                });
                document.getElementById('totalRevenue').textContent = '৳' + totalRevenue;
                
                // Load pending requests (you need to create rechargeRequests and withdrawRequests in database)
                document.getElementById('pendingRequests').textContent = '0';
                
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        
        // Generate password helper
        function generatePassword() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let password = '';
            for(let i = 0; i < 6; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return password;
        }
        
        // Logout
        function logout() {
            auth.signOut().then(() => {
                window.location.href = 'login.html';
            });
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            const user = auth.currentUser;
            if(!user) {
                window.location.href = 'login.html';
            }
        });
    </script>
    <!-- admin.html এর মধ্যে কোথাও যোগ করুন -->
<div class="card">
    <h3>➕ Add New Admin</h3>
    <input type="text" id="adminName" placeholder="Admin Full Name">
    <input type="email" id="adminEmail" placeholder="Admin Email">
    <input type="text" id="adminFFID" placeholder="Free Fire ID">
    <input type="number" id="adminBalance" placeholder="Initial Balance" value="5000">
    
    <div style="margin: 10px 0;">
        <label>
            <input type="checkbox" id="sendEmailInvite"> Send email invitation
        </label>
    </div>
    
    <button onclick="createNewAdmin()" class="btn btn-success">Create Admin Account</button>
</div>
</body>
</html>

