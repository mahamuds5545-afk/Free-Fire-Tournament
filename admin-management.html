<!DOCTYPE html>
<html>
<head>
    <title>Admin Management</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .card { background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 10px; }
        .btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; color: white; }
        .admin-list { margin-top: 20px; }
        .admin-item { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <div class="container">
        <h1>üëë Admin Management System</h1>
        
        <!-- Create New Admin -->
        <div class="card">
            <h2>‚ûï Create New Admin</h2>
            <input type="text" id="newAdminName" placeholder="Full Name" style="width:100%; padding:10px; margin:5px 0;">
            <input type="email" id="newAdminEmail" placeholder="Email" style="width:100%; padding:10px; margin:5px 0;">
            <input type="text" id="newAdminFFID" placeholder="Free Fire ID" style="width:100%; padding:10px; margin:5px 0;">
            <button onclick="createAdminAccount()" class="btn btn-primary">Create Admin Account</button>
        </div>
        
        <!-- Existing Admins -->
        <div class="card">
            <h2>üìã Current Admins</h2>
            <div id="adminsList" class="admin-list">
                Loading admins...
            </div>
        </div>
        
        <!-- Demote Admin -->
        <div class="card">
            <h2>‚¨áÔ∏è Demote Admin to User</h2>
            <select id="demoteSelect" style="width:100%; padding:10px; margin:5px 0;">
                <option value="">Select Admin to Demote</option>
            </select>
            <button onclick="demoteAdmin()" class="btn btn-danger">Demote to User</button>
        </div>
    </div>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyA9HKKBo6KozIskG2oEF0PO7UCCScIxXdQ",
            authDomain: "freefiregame-85e60.firebaseapp.com",
            databaseURL: "https://freefiregame-85e60-default-rtdb.firebaseio.com",
            projectId: "freefiregame-85e60",
            storageBucket: "freefiregame-85e60.firebasestorage.app",
            messagingSenderId: "961424698248",
            appId: "1:961424698248:web:32e3d79f1bdfefaa9b283d",
            measurementId: "G-7D31XM1SBC"
        };
        
        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        
        // Check if current user is super admin
        auth.onAuthStateChanged(async (user) => {
            if (!user) {
                window.location.href = 'login.html';
                return;
            }
            
            const userRef = database.ref('users/' + user.uid);
            userRef.once('value').then((snapshot) => {
                const userData = snapshot.val();
                if(!userData || userData.role !== 'admin') {
                    alert('Access denied! Admin only.');
                    window.location.href = 'user.html';
                } else {
                    loadAdmins();
                    loadAdminsForDemotion();
                }
            });
        });
        
        // Create new admin account
        async function createAdminAccount() {
            const name = document.getElementById('newAdminName').value;
            const email = document.getElementById('newAdminEmail').value;
            const ffid = document.getElementById('newAdminFFID').value;
            
            if(!name || !email || !ffid) {
                alert('Please fill all fields');
                return;
            }
            
            // Generate random password
            const tempPassword = generateRandomPassword();
            
            try {
                // 1. Create authentication account
                const userCredential = await auth.createUserWithEmailAndPassword(email, tempPassword);
                const newAdmin = userCredential.user;
                
                // 2. Save to database
                await database.ref('users/' + newAdmin.uid).set({
                    name: name,
                    email: email,
                    ffid: ffid,
                    balance: 10000,
                    role: 'admin',
                    isActive: true,
                    joinDate: new Date().toISOString(),
                    createdAt: Date.now(),
                    createdBy: auth.currentUser.uid
                });
                
                // 3. Send password reset email
                await auth.sendPasswordResetEmail(email);
                
                // Show success with credentials
                alert(`
                ‚úÖ Admin Account Created!
                
                Admin Details:
                Name: ${name}
                Email: ${email}
                Temporary Password: ${tempPassword}
                
                Login URL:
                https://YOUR_USERNAME.github.io/free-fire-tournament/login.html
                
                Instructions:
                1. Login with email and temporary password
                2. Change password immediately
                3. Start managing the system
                `);
                
                // Clear form
                document.getElementById('newAdminName').value = '';
                document.getElementById('newAdminEmail').value = '';
                document.getElementById('newAdminFFID').value = '';
                
                // Refresh lists
                loadAdmins();
                loadAdminsForDemotion();
                
            } catch (error) {
                alert('Error creating admin: ' + error.message);
            }
        }
        
        // Load all admins
        async function loadAdmins() {
            try {
                const snapshot = await database.ref('users').once('value');
                const container = document.getElementById('adminsList');
                
                if(snapshot.exists()) {
                    const users = snapshot.val();
                    let html = '';
                    let adminCount = 0;
                    
                    Object.keys(users).forEach(userId => {
                        const user = users[userId];
                        if(user.role === 'admin') {
                            adminCount++;
                            html += `
                                <div class="admin-item">
                                    <h3>${user.name}</h3>
                                    <p>Email: ${user.email}</p>
                                    <p>FF ID: ${user.ffid || 'N/A'}</p>
                                    <p>Balance: ‡ß≥${user.balance || 0}</p>
                                    <p>Joined: ${new Date(user.joinDate).toLocaleDateString()}</p>
                                    <button onclick="viewAdminDetails('${userId}')" class="btn">View Details</button>
                                    <button onclick="resetAdminPassword('${userId}', '${user.email}')" class="btn btn-warning">Reset Password</button>
                                </div>
                            `;
                        }
                    });
                    
                    if(adminCount === 0) {
                        html = '<p>No admins found.</p>';
                    }
                    
                    container.innerHTML = html;
                }
            } catch (error) {
                console.error('Error loading admins:', error);
            }
        }
        
        // Load admins for demotion dropdown
        async function loadAdminsForDemotion() {
            try {
                const snapshot = await database.ref('users').once('value');
                const select = document.getElementById('demoteSelect');
                select.innerHTML = '<option value="">Select Admin to Demote</option>';
                
                if(snapshot.exists()) {
                    const users = snapshot.val();
                    const currentUserId = auth.currentUser.uid;
                    
                    Object.keys(users).forEach(userId => {
                        const user = users[userId];
                        // Don't show current user in demote list
                        if(user.role === 'admin' && userId !== currentUserId) {
                            const option = document.createElement('option');
                            option.value = userId;
                            option.textContent = `${user.name} (${user.email})`;
                            select.appendChild(option);
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading admins:', error);
            }
        }
        
        // Demote admin to user
        async function demoteAdmin() {
            const userId = document.getElementById('demoteSelect').value;
            
            if(!userId) {
                alert('Please select an admin');
                return;
            }
            
            if(!confirm('Are you sure you want to demote this admin to regular user?')) {
                return;
            }
            
            try {
                await database.ref('users/' + userId).update({
                    role: 'user',
                    demotedAt: Date.now(),
                    demotedBy: auth.currentUser.uid
                });
                
                alert('Admin demoted to user successfully!');
                
                // Refresh lists
                loadAdmins();
                loadAdminsForDemotion();
                
            } catch (error) {
                alert('Error demoting admin: ' + error.message);
            }
        }
        
        // Reset admin password
        async function resetAdminPassword(userId, email) {
            try {
                await auth.sendPasswordResetEmail(email);
                alert(`Password reset email sent to ${email}`);
            } catch (error) {
                alert('Error sending reset email: ' + error.message);
            }
        }
        
        // View admin details
        function viewAdminDetails(userId) {
            database.ref('users/' + userId).once('value').then((snapshot) => {
                const user = snapshot.val();
                alert(`
                Admin Details:
                
                Name: ${user.name}
                Email: ${user.email}
                FF ID: ${user.ffid}
                Balance: ‡ß≥${user.balance}
                Role: ${user.role}
                Status: ${user.isActive ? 'Active' : 'Inactive'}
                Join Date: ${new Date(user.joinDate).toLocaleDateString()}
                `);
            });
        }
        
        // Helper functions
        function generateRandomPassword() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
            let password = '';
            for(let i = 0; i < 12; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return password;
        }
    </script>
</body>
</html>
